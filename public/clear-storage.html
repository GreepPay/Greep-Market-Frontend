<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clear Storage - Greep Market</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      button {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        margin: 10px 0;
      }
      button:hover {
        background-color: #c82333;
      }
      .success {
        background-color: #28a745;
      }
      .success:hover {
        background-color: #218838;
      }
      .info {
        background-color: #17a2b8;
        color: white;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Clear Storage Utility</h1>

      <div class="info">
        <strong
          >Use this page to clear invalid tokens from your browser
          storage.</strong
        >
        <br /><br />
        If you're experiencing "Invalid token" errors, click the button below to
        clear all stored authentication data.
      </div>

      <button onclick="clearStorage()">üóëÔ∏è Clear All Storage</button>
      <button onclick="checkStorage()" class="success">
        üîç Check Current Storage
      </button>
      <button onclick="goToLogin()" class="success">üöÄ Go to Login</button>

      <div
        id="result"
        style="
          margin-top: 20px;
          padding: 15px;
          border-radius: 5px;
          display: none;
        "
      ></div>
    </div>

    <script>
      function clearStorage() {
        try {
          // Clear localStorage
          localStorage.clear();

          // Clear sessionStorage
          sessionStorage.clear();

          // Clear any cookies (if any)
          document.cookie.split(";").forEach(function (c) {
            document.cookie = c
              .replace(/^ +/, "")
              .replace(
                /=.*/,
                "=;expires=" + new Date().toUTCString() + ";path=/"
              );
          });

          showResult(
            "‚úÖ All storage cleared successfully! You can now try logging in again.",
            "success"
          );
        } catch (error) {
          showResult("‚ùå Error clearing storage: " + error.message, "error");
        }
      }

      function checkStorage() {
        const accessToken = localStorage.getItem("access_token");
        const refreshToken = localStorage.getItem("refresh_token");

        let message = "<strong>Current Storage Status:</strong><br><br>";
        message += `Access Token: ${
          accessToken ? "‚úÖ Present" : "‚ùå Not found"
        }<br>`;
        message += `Refresh Token: ${
          refreshToken ? "‚úÖ Present" : "‚ùå Not found"
        }<br><br>`;

        if (accessToken) {
          try {
            const payload = JSON.parse(atob(accessToken.split(".")[1]));
            const now = Math.floor(Date.now() / 1000);
            const isExpired = payload.exp <= now;
            message += `Token Status: ${
              isExpired ? "‚ùå Expired" : "‚úÖ Valid"
            }<br>`;
            message += `Expires: ${new Date(
              payload.exp * 1000
            ).toLocaleString()}`;
          } catch (e) {
            message += `Token Status: ‚ùå Invalid format`;
          }
        }

        showResult(message, "info");
      }

      function goToLogin() {
        window.location.href = "/login";
      }

      function showResult(message, type) {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = message;
        resultDiv.style.display = "block";
        resultDiv.style.backgroundColor =
          type === "success"
            ? "#d4edda"
            : type === "error"
            ? "#f8d7da"
            : "#d1ecf1";
        resultDiv.style.color =
          type === "success"
            ? "#155724"
            : type === "error"
            ? "#721c24"
            : "#0c5460";
        resultDiv.style.border = `1px solid ${
          type === "success"
            ? "#c3e6cb"
            : type === "error"
            ? "#f5c6cb"
            : "#bee5eb"
        }`;
      }

      // Auto-check storage on page load
      window.onload = function () {
        checkStorage();
      };
    </script>
  </body>
</html>
